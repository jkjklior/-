import java.io.ByteArrayOutputStream;
import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.net.HttpURLConnection;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.Scanner;

public class Download {
	static int place=0;
	static int longer=0;
	static int now;
	
	public static byte[] readinputstream(InputStream is) throws IOException
	{
		byte[] buffer=new byte[40960];
		int len=0;
		ByteArrayOutputStream bos = new ByteArrayOutputStream();
		while((len=is.read(buffer))!=-1)
		{
			place+=len;
			bos.write(buffer, 0, len);
			System.out.printf("%.1f\n",(float)place/longer*100);
		}
		bos.close();
		return bos.toByteArray();
	}
	public static void downlaod(String urlstr,String filename,String savepath)
	{
		String ext=urlstr.substring(urlstr.lastIndexOf("."));
		try {
			URL url=new URL(urlstr);
			try {
				HttpURLConnection conn=(HttpURLConnection)url.openConnection();
				conn.setConnectTimeout(3*1000);
				//conn.setRequestMethod("GET");
				longer=conn.getContentLength();
				int code=0;
				code=conn.getResponseCode();
				if(code==200||code==206)
				{	
					InputStream is=conn.getInputStream();
					byte[] getdata=readinputstream(is);
					File file=new File(savepath);
					if(!file.exists()){file.mkdirs();}
					File data=new File(file+File.separator+filename+ext);
					FileOutputStream fos=new FileOutputStream(data);
					fos.write(getdata);
					if(fos!=null)fos.close();
					if(is!=null)is.close();
					System.out.println("download success");
				}
				
			} catch (IOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		} catch (MalformedURLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

	public static void main(String[] args) {
		// TODO Auto-generated method stub
		System.out.println("请输入文件URL：");
		Scanner first=new Scanner(System.in);
		String u=first.nextLine();
		System.out.println("请输入文件名：");
		Scanner second=new Scanner(System.in);
		String f=second.nextLine();
		System.out.println("请输入文件保存位置：");
		Scanner thrid=new Scanner(System.in);
		String s=thrid.nextLine();
		Download.downlaod(u,f,s);
	}

}
